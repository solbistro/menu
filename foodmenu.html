<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>SOL Bistro - Menu (Food & Drink)</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            /* ‰∏ªÈ°åËâ≤ */
            --color-primary: #d4af37;
            --color-primary-light: #f4d03f;

            /* ËÉåÊôØ */
            --bg-page: #2c3e50;
            --bg-page-alt: #34495e;
            --bg-card: rgba(40, 40, 40, .95);

            /* ÊñáÂ≠ó */
            --text-primary: #f0f0f0;
            --text-secondary: #aaa;

            /* ÈÇäÊ°Ü/ÂàÜÈöîÁ∑ö */
            --border-light: #555;

            /* ÁãÄÊÖãËâ≤ */
            --status-success: #7ed957;
            --status-warning: #ffb703;
            --status-danger: #ff6b6b;

            /* ÁÑ¶Èªû */
            --color-focus: #f4d03f;
        }

        body {
            background: linear-gradient(135deg, var(--bg-page) 0%, var(--bg-page-alt) 100%);
            font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif;
            color: var(--text-primary);
            padding: 20px;
            min-height: 100vh;
        }

        .menu-container {
            max-width: 1200px;
            margin: 0 auto;
            background: var(--bg-card);
            border: 3px solid var(--color-primary);
            border-radius: 12px;
            padding: 40px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, .5);
        }

        .header {
            text-align: center;
            border-bottom: 2px solid var(--color-primary);
            padding-bottom: 24px;
            margin-bottom: 24px;
        }

        .logo {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 32px;
            margin-bottom: 12px;
            flex-wrap: wrap;
        }

        .logo-title {
            font-size: 2.5em;
            font-weight: 800;
            letter-spacing: .06em;
        }

        .logo-circle {
            width: 112px;
            height: 112px;
            border: 3px solid var(--text-primary);
            border-radius: 50%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: rgba(60, 60, 60, .8);
        }

        .sol {
            font-size: 2.2em;
            font-weight: 800;
            line-height: 1;
        }

        .bistro {
            font-size: 1.2em;
            opacity: .9;
        }

        .wifi {
            background: #555;
            padding: 6px 14px;
            border-radius: 20px;
            display: inline-block;
            font-size: .9em;
            margin-top: 6px;
        }

        .rules {
            font-size: .9em;
            color: #ccc;
            line-height: 1.6;
            margin-top: 10px;
        }

        .tools {
            display: flex;
            gap: 12px;
            justify-content: space-between;
            align-items: center;
            margin-top: 18px;
            flex-wrap: wrap;
        }

        .language-switcher {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            justify-content: center;
        }

        /* ÊâãÊ©üÁâà‰∏ãÊãâÈÅ∏ÂñÆ (È†êË®≠Èö±Ëóè) */
        .language-select {
            display: none;
            width: 100%;
            max-width: 200px;
            padding: 10px 14px;
            background: rgba(60, 60, 60, .85);
            border: 2px solid #555;
            border-radius: 6px;
            color: var(--text-primary);
            font-size: 0.95em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            font-family: inherit;
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%23D4AF37' d='M6 9L1 4h10z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 12px center;
            padding-right: 36px;
        }

        .language-select:hover {
            border-color: var(--color-primary);
            box-shadow: 0 4px 8px rgba(212, 175, 55, .25);
        }

        .language-select:focus {
            outline: none;
            border-color: var(--color-primary);
            box-shadow: 0 0 0 3px rgba(212, 175, 55, .2);
        }

        .lang-btn {
            background: rgba(60, 60, 60, .85);
            border: 2px solid #555;
            color: var(--text-primary);
            padding: 8px 14px;
            border-radius: 999px;
            cursor: pointer;
            font-weight: 600;
            transition: .2s;
        }

        .lang-btn:hover {
            border-color: var(--color-primary);
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(212, 175, 55, .25);
        }

        .lang-btn[aria-pressed="true"] {
            background: linear-gradient(135deg, var(--color-primary), var(--color-primary-light));
            color: #2c3e50;
            border-color: var(--color-primary);
        }

        .right-tools {
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
        }

        .search {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .search input {
            background: #2e2e2e;
            border: 1px solid #4a4a4a;
            color: var(--text-primary);
            padding: 8px 12px;
            border-radius: 10px;
            min-width: 220px;
        }

        .toggle {
            display: flex;
            align-items: center;
            gap: 8px;
            background: #2e2e2e;
            border: 1px solid #4a4a4a;
            padding: 6px 10px;
            border-radius: 10px;
            font-size: .9em;
        }

        .btn {
            background: rgba(60, 60, 60, .9);
            border: 1px solid #666;
            color: var(--text-primary);
            padding: 8px 12px;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
        }

        .btn:hover {
            border-color: var(--color-primary);
        }

        .btn[disabled] {
            opacity: .6;
            cursor: not-allowed;
        }

        .spin {
            display: inline-block;
            transform-origin: center;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg)
            }
        }


        .filter-tags {
            display: flex;
            gap: 8px;
            margin-top: 8px;
            flex-wrap: wrap;
        }

        .filter-btn {
            background: rgba(60, 60, 60, .85);
            border: 1px solid #555;
            color: var(--text-primary);
            padding: 6px 12px;
            border-radius: 8px;
            cursor: pointer;
            font-size: .9em;
            font-weight: 600;
            transition: .2s;
        }

        .filter-btn:hover {
            border-color: var(--color-primary);
        }

        .filter-btn[aria-pressed="true"] {
            background: linear-gradient(135deg, var(--color-primary), var(--color-primary-light));
            color: #2c3e50;
            border-color: var(--color-primary);
        }

        /* ÂàÜÈ†ÅÂàáÊèõ */
        .menu-tabs {
            display: flex;
            gap: 12px;
            justify-content: center;
            margin-bottom: 16px;
        }

        .menu-tab {
            background: rgba(60, 60, 60, .85);
            border: 2px solid #555;
            color: var(--text-primary);
            padding: 12px 24px;
            border-radius: 12px;
            cursor: pointer;
            font-weight: 700;
            font-size: 1.1em;
            transition: .2s;
            text-transform: uppercase;
            letter-spacing: .05em;
        }

        .menu-tab:hover {
            border-color: var(--color-primary);
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(212, 175, 55, .3);
        }

        .menu-tab[aria-selected="true"] {
            background: linear-gradient(135deg, var(--color-primary), var(--color-primary-light));
            color: #2c3e50;
            border-color: var(--color-primary);
            box-shadow: 0 4px 8px rgba(212, 175, 55, .4);
        }

        /* È£≤ÊñôÂ∞àÁî®Ê®ôÁ±§ */
        .badge.alcohol {
            border-color: #e74c3c;
            color: #e74c3c;
        }

        .badge.body {
            border-color: #3498db;
            color: #3498db;
        }

        .badge.flavor {
            border-color: #9b59b6;
            color: #9b59b6;
        }

        .notice-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
            margin-top: 16px;
            text-align: left;
        }

        .notice-card {
            background: rgba(30, 30, 30, .85);
            border: 1px solid #555;
            border-radius: 10px;
            padding: 14px;
        }

        .notice-title {
            font-weight: 800;
            margin-bottom: 10px;
            color: var(--color-primary);
            font-size: 1.05em;
        }

        .notice-list {
            list-style: none;
            display: grid;
            gap: 8px;
        }

        .notice-list li {
            line-height: 1.5;
            border-left: 3px solid #444;
            padding-left: 10px;
            color: #ddd;
        }

        .menu-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 36px;
            margin-top: 18px;
        }

        .menu-section {
            margin-bottom: 24px;
        }

        .section-title {
            background: linear-gradient(to right, var(--color-primary), var(--color-primary-light));
            color: #2c3e50;
            padding: 8px 14px;
            font-weight: 800;
            text-transform: uppercase;
            margin-bottom: 14px;
            clip-path: polygon(0 0, 95% 0, 100% 50%, 95% 100%, 0 100%);
            display: inline-block;
            min-width: 140px;
        }

        .menu-item {
            display: grid;
            grid-template-columns: auto 1fr auto;
            grid-template-areas:
                "thumb info price"
                "accordion accordion accordion";
            gap: 12px;
            margin-bottom: 16px;
            padding: 12px;
            background: rgba(40, 40, 40, 0.3);
            border-radius: 10px;
            border: 1px solid transparent;
            transition: all 0.2s ease;
        }

        .menu-item:hover {
            background: rgba(50, 50, 50, 0.4);
            border-color: rgba(212, 175, 55, 0.3);
            transform: translateY(-1px);
        }

        .item-name {
            grid-area: info;
            display: flex;
            flex-direction: column;
            gap: 4px;
            min-width: 0;
        }

        .name-primary {
            font-size: 1.1em;
            font-weight: 700;
            line-height: 1.3;
            color: var(--text-primary);
            cursor: pointer;
            transition: color 0.2s ease;
        }

        .name-primary:hover {
            color: var(--color-primary);
        }

        .name-secondary {
            font-size: 0.9em;
            color: var(--text-secondary);
            line-height: 1.4;
        }

        .badges {
            display: flex;
            gap: 6px;
            flex-wrap: wrap;
            margin-top: 4px;
        }

        .badge {
            border: 1px solid #666;
            border-radius: 8px;
            padding: 2px 6px;
            font-size: .75em;
            opacity: .95;
        }

        .badge.vegan {
            border-color: var(--status-success);
        }

        .badge.spicy {
            border-color: var(--status-warning);
        }

        .badge.allergen {
            border-color: #888;
        }

        .price {
            grid-area: price;
            font-weight: 800;
            font-size: 1.15em;
            white-space: nowrap;
            color: var(--color-primary);
            text-align: right;
            align-self: start;
            padding-top: 2px;
        }

        .soldout {
            opacity: 0.7;
            position: relative;
        }

        .soldout::after {
            content: "SOLD OUT";
            position: absolute;
            top: 8px;
            right: 8px;
            background: var(--status-danger);
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.7em;
            font-weight: 700;
            letter-spacing: 0.05em;
        }

        .soldout .name-primary,
        .soldout .name-secondary {
            opacity: 0.7;
            text-decoration: line-through;
        }

        .thumb {
            grid-area: thumb;
            width: 90px;
            height: 90px;
            object-fit: cover;
            border-radius: 8px;
            border: 2px solid rgba(255, 255, 255, 0.1);
            background: #2a2a2a;
            flex-shrink: 0;
            transition: transform 0.2s ease;
        }

        .menu-item:hover .thumb {
            transform: scale(1.05);
            border-color: rgba(212, 175, 55, 0.4);
        }

        /* Èö±Ëóè Accordion ÂçÄÂüü */
        .accordion {
            display: none;
        }

        /* Popover ÊµÆÂãïÊèêÁ§∫ */
        .info-popover {
            position: fixed;
            z-index: 10000;
            min-width: 250px;
            max-width: 400px;
            background: linear-gradient(145deg, rgba(35, 35, 35, 0.98), rgba(25, 25, 25, 0.98));
            border: 2px solid var(--color-primary);
            border-radius: 12px;
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.7);
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.2s ease, visibility 0.2s ease, transform 0.2s ease;
            transform: translateY(8px);
            pointer-events: none;
        }

        .info-popover.active {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
            pointer-events: auto;
        }

        .popover-header {
            padding: 14px 18px;
            background: linear-gradient(135deg, var(--color-primary), var(--color-primary-light));
            color: #2c3e50;
            font-weight: 700;
            font-size: 1.05em;
            border-radius: 10px 10px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .popover-close {
            background: rgba(0, 0, 0, 0.2);
            border: none;
            color: #2c3e50;
            font-size: 1.4em;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.15s ease;
            line-height: 1;
            padding: 0;
        }

        .popover-close:hover {
            background: rgba(0, 0, 0, 0.3);
            transform: rotate(90deg);
        }

        .popover-body {
            padding: 16px;
            max-height: 400px;
            overflow-y: auto;
        }

        .popover-section {
            margin-bottom: 14px;
        }

        .popover-section:last-child {
            margin-bottom: 0;
        }

        .popover-section-title {
            font-size: 0.95em;
            font-weight: 700;
            color: var(--color-primary);
            margin-bottom: 6px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .popover-section-content {
            color: var(--text-primary);
            line-height: 1.7;
            font-size: 0.9em;
            padding-left: 18px;
            border-left: 2px solid var(--color-primary);
        }

        /* ÁÆ≠È†≠ÊåáÁ§∫Âô® */
        .popover-arrow {
            position: absolute;
            width: 0;
            height: 0;
            border: 10px solid transparent;
        }

        .popover-arrow.top {
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            border-bottom-color: var(--color-primary);
        }

        .popover-arrow.bottom {
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            border-top-color: var(--color-primary);
        }

        /* ÊªæÂãïÊ¢ùÊ®£Âºè */
        .popover-body::-webkit-scrollbar {
            width: 6px;
        }

        .popover-body::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 3px;
        }

        .popover-body::-webkit-scrollbar-thumb {
            background: var(--color-primary);
            border-radius: 3px;
        }

        .popover-body::-webkit-scrollbar-thumb:hover {
            background: var(--color-primary-light);
        }

        /* Popover ÂÖßÂÆπÂçÄÂ°äÊ®£Âºè */
        .popover-section {
            margin-bottom: 16px;
        }

        .popover-section:last-child {
            margin-bottom: 0;
        }

        .popover-section-title {
            font-size: 0.9em;
            font-weight: 600;
            color: var(--color-primary);
            margin-bottom: 8px;
            padding-bottom: 6px;
            border-bottom: 1px solid rgba(215, 169, 92, 0.3);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .popover-section-content {
            font-size: 0.95em;
            line-height: 1.6;
            color: var(--text-primary);
        }

        .loading {
            grid-column: 1/-1;
            text-align: center;
            padding: 36px;
            font-size: 1.1em;
            color: var(--color-primary);
        }

        .loading::after {
            content: "...";
            animation: dots 1.5s steps(4, end) infinite;
        }

        @keyframes dots {

            0%,
            20% {
                content: "."
            }

            40% {
                content: ".."
            }

            60%,
            100% {
                content: "..."
            }
        }

        .error {
            grid-column: 1/-1;
            background: rgba(255, 107, 107, .1);
            border: 2px solid var(--status-danger);
            border-radius: 10px;
            padding: 20px;
            color: var(--status-danger);
        }

        .error-details {
            background: rgba(0, 0, 0, .3);
            padding: 10px;
            border-radius: 8px;
            margin-top: 10px;
            font-family: ui-monospace, Consolas, Monaco, monospace;
            font-size: .9em;
            color: #ffd700;
        }

        :focus-visible {
            outline: 3px solid var(--color-focus);
            outline-offset: 2px;
            border-radius: 8px;
        }

        @media print {
            body {
                background: white;
                padding: 0;
            }

            .menu-container {
                box-shadow: none;
                border: none;
            }


            .wifi {
                display: none;
            }

            .menu-content {
                grid-template-columns: 1fr 1fr;
            }

            .section-title {
                clip-path: none;
                border-radius: 6px;
            }

            .badge {
                border-color: #bbb;
                color: #333;
            }

            .price {
                color: #000;
            }
        }

        @media(max-width:900px) {
            .menu-content {
                grid-template-columns: 1fr;
            }

            .notice-grid {
                grid-template-columns: 1fr;
            }

            .menu-container {
                padding: 20px;
            }

            .logo-title {
                font-size: 2em;
            }

            .logo-circle {
                width: 90px;
                height: 90px;
            }

            .sol {
                font-size: 1.8em;
            }

            .bistro {
                font-size: 1em;
            }
        }

        @media(max-width:640px) {
            body {
                padding: 10px;
            }

            .menu-container {
                padding: 16px;
                border-width: 2px;
            }

            /* ÊâãÊ©üÁâàÔºöÈö±ËóèË™ûË®ÄÊåâÈàïÔºåÈ°ØÁ§∫‰∏ãÊãâÈÅ∏ÂñÆ */
            .language-switcher .lang-btn {
                display: none;
            }

            .language-select {
                display: block;
                margin: 0 auto;
            }

            .tools {
                gap: 12px;
            }

            .header {
                padding-bottom: 16px;
                margin-bottom: 16px;
            }

            .logo {
                gap: 16px;
            }

            .logo-title {
                font-size: 1.6em;
            }

            .logo-circle {
                width: 80px;
                height: 80px;
            }

            .sol {
                font-size: 1.5em;
            }

            .bistro {
                font-size: 0.9em;
            }

            .menu-tab {
                padding: 10px 16px;
                font-size: 1em;
            }

            .tools {
                flex-direction: column;
                align-items: stretch;
            }

            .right-tools {
                flex-direction: column;
                width: 100%;
            }

            .search {
                width: 100%;
            }

            .search input {
                width: 100%;
                min-width: auto;
            }

            /* ÊâãÊ©üÁâàËèúÂñÆÈ†ÖÁõÆÂÑ™Âåñ */
            .menu-item {
                grid-template-columns: 80px 1fr;
                grid-template-areas:
                    "thumb info"
                    "thumb price"
                    "accordion accordion";
                gap: 10px;
                padding: 12px;
                margin-bottom: 12px;
            }

            .thumb {
                width: 80px;
                height: 80px;
                align-self: start;
            }

            .item-name {
                gap: 6px;
            }

            .name-primary {
                font-size: 1.05em;
                line-height: 1.35;
            }

            .name-secondary {
                font-size: 0.85em;
                line-height: 1.5;
            }

            .price {
                font-size: 1.1em;
                text-align: left;
                padding-top: 0;
                align-self: end;
            }

            .badges {
                flex-wrap: wrap;
            }

            .badge {
                font-size: 0.7em;
                padding: 2px 5px;
            }

            .accordion {
                margin-top: 6px;
                padding-top: 10px;
                gap: 6px;
            }

            .accordion-header {
                padding: 5px 10px;
                font-size: 0.8em;
            }

            .accordion-content {
                min-width: 180px;
                max-width: 280px;
                font-size: 0.82em;
                line-height: 1.6;
                padding: 10px 12px;
            }

            /* ÊâãÊ©üÁâàÔºöTooltip ÊîπÁÇ∫Âæû‰∏ãÊñπÂΩàÂá∫ */
            .accordion-item:hover .accordion-content,
            .accordion-item.active .accordion-content {
                bottom: auto;
                top: calc(100% + 8px);
                transform: translateX(-50%) translateY(4px);
            }

            .accordion-content::after {
                top: auto;
                bottom: 100%;
                border-top-color: transparent;
                border-bottom-color: var(--color-primary);
            }

            .soldout::after {
                top: 6px;
                right: 6px;
                font-size: 0.65em;
                padding: 3px 6px;
            }

            .section-title {
                font-size: 0.95em;
                padding: 7px 12px;
                min-width: 120px;
            }

            .notice-card {
                padding: 12px;
            }

            .notice-title {
                font-size: 1em;
            }

            .notice-list li {
                font-size: 0.9em;
            }
        }

        @media(max-width:400px) {
            .menu-item {
                grid-template-columns: 70px 1fr;
                gap: 8px;
                padding: 10px;
            }

            .thumb {
                width: 70px;
                height: 70px;
            }

            .name-primary {
                font-size: 1em;
            }

            .name-secondary {
                font-size: 0.82em;
            }

            .price {
                font-size: 1.05em;
            }

            .accordion-header {
                padding: 5px 8px;
                font-size: 0.75em;
            }

            .accordion-content {
                min-width: 160px;
                max-width: 250px;
                font-size: 0.78em;
                padding: 9px 10px;
            }
        }
    </style>
</head>

<body>
    <div class="menu-container">
        <header class="header">
            <div class="logo" aria-label="SOL Bistro logo">
                <div class="logo-circle">
                    <div class="sol">SOL</div>
                    <div class="bistro">bistro</div>
                </div>
                <div class="logo-title">MENU</div>
            </div>
            <div class="wifi" aria-label="Wi-Fi info">üåê FREE Wi-Fi | solbistro2018</div>

            <!-- ÂàÜÈ†ÅÂàáÊèõ -->
            <div class="menu-tabs" role="tablist" aria-label="Menu type selector">
                <button class="menu-tab" role="tab" data-menu-type="food" aria-selected="true">üçΩÔ∏è Food Menu</button>
                <button class="menu-tab" role="tab" data-menu-type="drink" aria-selected="false">üç∑ Drink Menu</button>
            </div>

            <div class="tools">
                <div class="language-switcher" role="tablist" aria-label="Language switcher">
                    <!-- ÊâãÊ©üÁâà‰∏ãÊãâÈÅ∏ÂñÆ -->
                    <select class="language-select" id="languageSelect" aria-label="Select language">
                        <option value="zh">‰∏≠Êñá</option>
                        <option value="en">English</option>
                        <option value="ja">Êó•Êú¨Ë™û</option>
                        <option value="ko">ÌïúÍµ≠Ïñ¥</option>
                        <option value="fr">Fran√ßais</option>
                        <option value="th">‡πÑ‡∏ó‡∏¢</option>
                        <option value="fil">Filipino</option>
                        <option value="vi">Ti·∫øng Vi·ªát</option>
                    </select>
                </div>
                <div class="right-tools">
                    <div class="search">
                        <label for="q" class="visually-hidden" style="position:absolute;left:-9999px">Search</label>
                        <input id="q" type="search" placeholder="Search / Ê™¢Á¥¢ / Ê§úÁ¥¢ÔºàÂ§öË™ûÈóúÈçµÂ≠óÔºâ" />
                    </div>
                    <label class="toggle">
                        <input id="hideSoldout" type="checkbox" />
                        <span>Èö±ËóèÂîÆÁΩÑ</span>
                    </label>
                    <button id="refreshBtn" class="btn" type="button" title="Âç≥ÊôÇÂà∑Êñ∞Ôºà‰∏çÈáçÊï¥È†ÅÈù¢Ôºâ">
                        <span id="refreshIcon" aria-hidden="true">üîÑ</span> Âç≥ÊôÇÂà∑Êñ∞
                    </button>
                </div>
            </div>
            <section class="notice-grid" aria-label="House rules and notes">
                <div class="notice-card">
                    <h3 class="notice-title">House Rules</h3>
                    <ul id="rulesList" class="notice-list"></ul>
                </div>
                <div class="notice-card">
                    <h3 class="notice-title">Notes</h3>
                    <ul id="notesList" class="notice-list"></ul>
                    <div class="toc"></div>
                    <div class="toc-wrapper">
                        <div class="filter-tags">
                            <button class="filter-btn" data-filter="all" aria-pressed="true">ÂÖ®ÈÉ®</button>
                            <button class="filter-btn" data-filter="vegan">Vegan</button>
                        </div>
                    </div>
                </div>
            </section>
        </header>

        <main id="menuContent" class="menu-content" aria-live="polite">
            <div class="loading">Ê≠£Âú®ËºâÂÖ•ËèúÂñÆ</div>
        </main>
    </div>

    <!-- Popover ÊµÆÂãïÊèêÁ§∫ -->
    <div id="infoPopover" class="info-popover">
        <div class="popover-arrow"></div>
        <div class="popover-header">
            <span id="popoverTitle"></span>
            <button id="popoverClose" class="popover-close" aria-label="Close">√ó</button>
        </div>
        <div id="popoverBody" class="popover-body"></div>
    </div>

    <script>
        // ===== CONSTANTS =====
        // Áµ±‰∏Ä APIÔºàÂêåÊôÇÂõûÂÇ≥ food Âíå drinkÔºâ
        const UNIFIED_API_URL = 'https://script.google.com/macros/s/AKfycbyupxncbMBRvQE9efRpDMUZcE1lSyELlBMjIlReQ-JtgwYN_7W-KhMBi_YCf2pzJD2u/exec';

        const API_URLS = {
            food: UNIFIED_API_URL,
            drink: UNIFIED_API_URL
        };

        const MAX_SPICY_LEVEL = 3;
        const SEARCH_DEBOUNCE_MS = 300;
        const IMAGE_FALLBACK_SIZE = 84;

        const CATEGORIES = [
            { name: 'SALAD', column: 'left' },
            { name: 'PAELLA', column: 'left' },
            { name: 'PASTA', column: 'left' },
            { name: 'PIZZA', column: 'left' },
            { name: 'TAPAS', column: 'right' },
            { name: 'DESSERT', column: 'right' }
        ];

        const LANGUAGES = [
            { code: 'zh', label: '‰∏≠Êñá' },
            { code: 'en', label: 'English' },
            { code: 'ja', label: 'Êó•Êú¨Ë™û' },
            { code: 'ko', label: 'ÌïúÍµ≠Ïñ¥' },
            { code: 'fr', label: 'Fran√ßais' },
            { code: 'th', label: '‡πÑ‡∏ó‡∏¢' },
            { code: 'fil', label: 'Filipino' },
            { code: 'vi', label: 'Ti·∫øng Vi·ªát' }
        ];

        const ACCORDION_LABELS = {
            ingredients: {
                zh: 'ÊàêÂàÜ',
                en: 'Ingredients',
                ja: 'ÊàêÂàÜ',
                ko: 'ÏÑ±Î∂Ñ',
                fr: 'Ingr√©dients',
                th: '‡∏™‡πà‡∏ß‡∏ô‡∏ú‡∏™‡∏°',
                fil: 'Sangkap',
                vi: 'Th√†nh ph·∫ßn'
            },
            allergens: {
                zh: 'ÈÅéÊïèÂéü',
                en: 'Allergens',
                ja: '„Ç¢„É¨„É´„Ç≤„É≥',
                ko: 'ÏïåÎ†àÎ•¥Í≤ê',
                fr: 'Allerg√®nes',
                th: '‡∏™‡∏≤‡∏£‡∏Å‡πà‡∏≠‡∏†‡∏π‡∏°‡∏¥‡πÅ‡∏û‡πâ',
                fil: 'Allergen',
                vi: 'Ch·∫•t g√¢y d·ªã ·ª©ng'
            },
            notes: {
                zh: 'ÂÇôË®ª',
                en: 'Notes',
                ja: 'ÂÇôËÄÉ',
                ko: 'ÎπÑÍ≥†',
                fr: 'Remarques',
                th: '‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏',
                fil: 'Tala',
                vi: 'Ghi ch√∫'
            }
        };

        const NO_INFO_MESSAGES = {
            zh: 'Êö´ÁÑ°Ë©≥Á¥∞Ë≥áË®ä',
            en: 'No additional information available',
            ja: 'Ë©≥Á¥∞ÊÉÖÂ†±„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì',
            ko: 'Ï∂îÍ∞Ä Ï†ïÎ≥¥ ÏóÜÏùå',
            fr: 'Aucune information suppl√©mentaire',
            th: '‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°',
            fil: 'Walang karagdagang impormasyon',
            vi: 'Kh√¥ng c√≥ th√¥ng tin b·ªï sung'
        };

        // ===== STATE MANAGEMENT =====
        const createStore = (initialState) => {
            let state = initialState;
            const listeners = new Set();

            return {
                getState: () => state,
                setState: (updates) => {
                    const oldState = state;
                    state = { ...state, ...updates };

                    // Ê∑±Â∫¶Âêà‰Ωµ ui ÁãÄÊÖã
                    if (updates.ui) {
                        state.ui = { ...oldState.ui, ...updates.ui };
                    }

                    listeners.forEach(fn => fn(state, oldState));
                },
                subscribe: (fn) => {
                    listeners.add(fn);
                    return () => listeners.delete(fn);
                }
            };
        };

        const store = createStore({
            foodData: {},
            drinkData: {},
            foodMeta: { rules: [], notes: [] },
            drinkMeta: { rules: [], notes: [] },
            ui: {
                currentMenuType: 'food',  // 'food' or 'drink'
                currentLang: 'zh',
                query: '',
                hideSoldOut: false,
                currentFilter: 'all'
            }
        });

        // Ë®ÇÈñ±ÁãÄÊÖãËÆäÂåñËá™ÂãïÈáçÁπ™
        store.subscribe((state, oldState) => {
            const uiChanged = state.ui !== oldState.ui;
            const menuTypeChanged = state.ui.currentMenuType !== oldState.ui.currentMenuType;

            const currentData = state.ui.currentMenuType === 'food' ? state.foodData : state.drinkData;
            const oldData = oldState.ui.currentMenuType === 'food' ? oldState.foodData : oldState.drinkData;
            const dataChanged = currentData !== oldData;

            const currentMeta = state.ui.currentMenuType === 'food' ? state.foodMeta : state.drinkMeta;
            const oldMeta = oldState.ui.currentMenuType === 'food' ? oldState.foodMeta : oldState.drinkMeta;
            const metaChanged = currentMeta !== oldMeta;

            if (dataChanged || uiChanged || menuTypeChanged) {
                renderMenu(currentData);
            }

            if (metaChanged || menuTypeChanged || (uiChanged && state.ui.currentLang !== oldState.ui.currentLang)) {
                renderNotices(currentMeta);
            }
        });

        // ===== HELPER FUNCTIONS (DRY PRINCIPLE) =====
        const isSoldOut = (item) => {
            // ÊîØÊè¥È£üÁâ©ËèúÂñÆÁöÑ soldout ÂíåÈ£≤ÊñôËèúÂñÆÁöÑ sold-out
            const soldoutValue = item['soldout'] ?? item.soldout;
            return soldoutValue === true || String(soldoutValue).toLowerCase() === 'true';
        };

        const isVegan = (item) =>
            String(item.vegan).toLowerCase() === 'true';

        const getSpicyLevel = (item) => {
            const level = Number(item.spicy);
            return isFinite(level) ? level : 0;
        };

        const escapeHtml = (s) => {
            return String(s ?? '').replace(/[&<>"']/g, c => ({
                '&': '&amp;',
                '<': '&lt;',
                '>': '&gt;',
                '"': '&quot;',
                "'": '&#39;'
            }[c]));
        };

        // ===== PURE FUNCTIONS FOR MENU RENDERING =====
        function getEffectiveCategories(data, categories) {
            const hasFixedData = categories.some(cat =>
                Array.isArray(data?.[cat.name]) && data[cat.name].length > 0
            );
            return hasFixedData
                ? categories.map(c => c.name)
                : Object.keys(data);
        }

        function filterItems(items, { query, hideSoldOut, currentFilter }) {
            return items.filter(it => {
                if (hideSoldOut && isSoldOut(it)) {
                    return false;
                }

                if (query) {
                    // ÂåÖÂê´È£≤ÊñôËèúÂñÆÁöÑ zh-TW Ê¨Ñ‰ΩçÂíåÂÖ∂‰ªñÈ£≤ÊñôÁõ∏ÈóúÊ¨Ñ‰Ωç
                    const searchText = [
                        it['zh-TW'], it.zh, it.en, it.ja, it.ko, it.fr, it.th, it.fil, it.vi,
                        it.contains, it.flavor, it.categories, it.img, it['img-url']
                    ].filter(Boolean).join(' ').toLowerCase();
                    if (!searchText.includes(query)) return false;
                }

                if (currentFilter === 'vegan' && !isVegan(it)) {
                    return false;
                }

                if (currentFilter === 'spicy' && getSpicyLevel(it) <= 0) {
                    return false;
                }

                return true;
            });
        }

        function distributeColumns(sections, categories) {
            const left = [], right = [];
            sections.forEach((sec, idx) => {
                const fixed = categories.find(c => c.name === sec.name);
                const target = fixed
                    ? (fixed.column === 'left' ? left : right)
                    : (idx % 2 === 0 ? left : right);
                target.push(sec);
            });
            return { left, right };
        }

        // ===== LANGUAGE & FORMATTING =====
        // Â§öË™ûÂÖßÂÆπÈÅ∏ÊìáÂô®ÔºàÊîØÊè¥Êñ∞ËàäÊ†ºÂºèÔºâ
        function pickLangText(field, lang) {
            if (!field) return '';

            // Êñ∞ÁâàÔºàÂ§öË™ûÁâ©‰ª∂Ôºâ
            if (typeof field === 'object' && !Array.isArray(field)) {
                return (
                    field[lang] ||
                    field.en ||
                    field.zh ||
                    field['zh-TW'] ||
                    Object.values(field).find(v => v) ||
                    ''
                );
            }

            // ËàäÁâàÔºàÂñÆ‰∏ÄÂ≠ó‰∏≤Ôºâ
            return String(field);
        }

        function pickLang(item, lang) {
            // ËôïÁêÜÈ£≤ÊñôËèúÂñÆÁöÑ zh-TW Ê¨Ñ‰ΩçÔºàÊò†Â∞ÑÂà∞ zhÔºâ
            const langKey = lang === 'zh' && item['zh-TW'] ? 'zh-TW' : lang;

            const val = (item[langKey] || '').trim();
            if (val) return { text: val, langTag: lang };

            // Fallback È†ÜÂ∫è
            if ((item.en || '').trim()) return { text: item.en.trim(), langTag: 'en' };
            if ((item['zh-TW'] || '').trim()) return { text: item['zh-TW'].trim(), langTag: 'zh' };
            if ((item.zh || '').trim()) return { text: item.zh.trim(), langTag: 'zh' };

            const alt = ['ja', 'ko', 'fr', 'th', 'fil', 'vi'].map(k => item[k]).find(v => v && v.trim());
            return { text: alt ? alt.trim() : '‚Äî', langTag: alt ? 'other' : '' };
        }

        function pickSecondary(item, lang) {
            if (lang === 'en') {
                const s = (item['zh-TW'] || item.zh || '').trim();
                return { text: s, langTag: s ? 'zh' : '' };
            } else {
                const s = (item.en || item['zh-TW'] || item.zh || '').trim();
                return { text: s, langTag: s ? (item.en ? 'en' : 'zh') : '' };
            }
        }

        function pickText(item, lang) {
            // ËôïÁêÜÈ£≤ÊñôËèúÂñÆÁöÑ zh-TW Ê¨Ñ‰Ωç
            const langKey = lang === 'zh' && item?.['zh-TW'] ? 'zh-TW' : lang;

            const val = (item?.[langKey] || '').trim();
            if (val) return val;

            // Fallback
            if ((item?.en || '').trim()) return item.en.trim();
            if ((item?.['zh-TW'] || '').trim()) return item['zh-TW'].trim();
            if ((item?.zh || '').trim()) return item.zh.trim();

            const altKey = ['ja', 'ko', 'fr', 'th', 'fil', 'vi'].find(k => (item?.[k] || '').trim());
            return altKey ? item[altKey].trim() : '';
        }

        const twdFmt = new Intl.NumberFormat('zh-TW', {
            style: 'currency',
            currency: 'TWD',
            maximumFractionDigits: 0
        });

        function formatTWD(v) {
            const n = Number(v);
            return isFinite(n) ? twdFmt.format(n) : (v ?? '');
        }

        // Accordion Ê∏≤ÊüìÂáΩÊï∏ÔºàÂ§öË™ûÊîØÊè¥Ôºâ
        function renderAccordion(item) {
            const state = store.getState();
            const lang = state.ui.currentLang;
            const sections = [];

            const allergensText = pickLangText(item.contains, lang);
            const ingredientsText = pickLangText(item.ingredients, lang);
            const notesText = pickLangText(item.notes, lang);

            if (allergensText) {
                sections.push({
                    key: 'allergens',
                    content: allergensText
                });
            }

            if (ingredientsText) {
                sections.push({
                    key: 'ingredients',
                    content: ingredientsText
                });
            }

            if (notesText) {
                sections.push({
                    key: 'notes',
                    content: notesText
                });
            }

            if (!sections.length) return '';

            return `
                <div class="accordion">
                    ${sections.map(sec => `
                        <div class="accordion-item">
                            <div class="accordion-header">
                                <span>${ACCORDION_LABELS[sec.key]?.[lang] || ACCORDION_LABELS[sec.key]?.en}</span>
                                <span class="accordion-icon">‚ÑπÔ∏è</span>
                            </div>
                            <div class="accordion-content">
                                ${escapeHtml(sec.content)}
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        function renderBadges(item) {
            const state = store.getState();
            const badges = [];

            // Food Â∞àÁî®Ê®ôÁ±§
            if (state.ui.currentMenuType === 'food') {
                if (isVegan(item)) {
                    badges.push('<span class="badge vegan" title="Vegan / Á¥îÁ¥†">Vegan</span>');
                }

                const spicy = getSpicyLevel(item);
                if (spicy > 0) {
                    const level = Math.min(spicy, MAX_SPICY_LEVEL);
                    badges.push(`<span class="badge spicy" title="Spicy / Ëæ£Â∫¶">${'üå∂'.repeat(level)}</span>`);
                }

                if (item.contains) {
                    const list = String(item.contains).split(/[,Ôºå;Ôºõ]/).map(s => s.trim()).filter(Boolean);
                    if (list.length) {
                        badges.push(`<span class="badge allergen" title="Allergens / ÈÅéÊïèÂéü">${escapeHtml(list.join(' ¬∑ '))}</span>`);
                    }
                }
            }

            // Drink Â∞àÁî®Ê®ôÁ±§
            if (state.ui.currentMenuType === 'drink') {
                // Alcohol ÊøÉÂ∫¶ÔºàÁî®ÈÖíÊùØÂúñÁ§∫Ë°®Á§∫Ôºâ
                const alcohol = Number(item.alcohol);
                if (isFinite(alcohol) && alcohol > 0) {
                    const level = Math.min(Math.ceil(alcohol / 3), 3); // ÂàÜÊàê 3 Á¥ö
                    badges.push(`<span class="badge alcohol" title="Alcohol / ÈÖíÁ≤æÊøÉÂ∫¶: ${alcohol}%">${'üç∑'.repeat(level)}</span>`);
                }

                // Body ÊøÉÈÉÅÂ∫¶
                const body = Number(item.body);
                if (isFinite(body) && body > 0) {
                    const level = Math.min(body, 3);
                    badges.push(`<span class="badge body" title="Body / ÊøÉÈÉÅÂ∫¶">${'‚óè'.repeat(level)}</span>`);
                }

                // Flavor È¢®Âë≥Ê®ôÁ±§
                if (item.flavor) {
                    const flavors = String(item.flavor).split(/[,Ôºå;Ôºõ]/).map(s => s.trim()).filter(Boolean);
                    if (flavors.length) {
                        badges.push(`<span class="badge flavor" title="Flavor / È¢®Âë≥">${escapeHtml(flavors.join(' ¬∑ '))}</span>`);
                    }
                }
            }

            return badges.length ? `<div class="badges">${badges.join('')}</div>` : '';
        }

        // ===== RENDERING FUNCTIONS =====
        function createSection(name, items) {
            const state = store.getState();
            const sec = document.createElement('section');
            sec.className = 'menu-section';
            sec.id = `cat-${name}`;

            const title = document.createElement('div');
            title.className = 'section-title';
            title.textContent = name;
            sec.appendChild(title);

            items.forEach(item => {
                const div = document.createElement('article');
                div.className = 'menu-item';
                if (isSoldOut(item)) {
                    div.classList.add('soldout');
                }

                const { text: primary, langTag: pTag } = pickLang(item, state.ui.currentLang);
                const { text: secondary, langTag: sTag } = pickSecondary(item, state.ui.currentLang);
                const priceStr = formatTWD(item.price);

                // ÊîØÊè¥È£≤ÊñôËèúÂñÆÁöÑ img-url Ê¨Ñ‰Ωç
                const imgSrc = item['img-url'] || item.img;
                const imgAlt = item.en || item['zh-TW'] || item.zh || 'item image';

                const imgHtml = imgSrc ? `
                    <img class="thumb" src="${escapeHtml(imgSrc)}"
                        alt="${escapeHtml(imgAlt)}"
                        loading="lazy" decoding="async" width="${IMAGE_FALLBACK_SIZE}" height="${IMAGE_FALLBACK_SIZE}"
                        onerror="this.style.display='none'" />` : '';

                div.innerHTML = `
                    ${imgHtml}
                    <div class="item-name">
                        <div class="name-primary">${escapeHtml(primary)}${pTag ? ` <small style="opacity:.7">(${pTag})</small>` : ''}</div>
                        <div class="name-secondary">${escapeHtml(secondary)}${sTag ? ` <small style="opacity:.6">(${sTag})</small>` : ''}</div>
                        ${renderBadges(item)}
                    </div>
                    ${renderAccordion(item)}
                    <div class="price" aria-label="Price">NT ${priceStr}</div>`;

                sec.appendChild(div);
            });

            return sec;
        }

        function renderColumns(left, right) {
            const menuContent = document.getElementById('menuContent');
            menuContent.innerHTML = '';

            const leftCol = document.createElement('div');
            const rightCol = document.createElement('div');

            left.forEach(sec => leftCol.appendChild(sec));
            right.forEach(sec => rightCol.appendChild(sec));

            menuContent.appendChild(leftCol);
            menuContent.appendChild(rightCol);
        }

        function showEmptyState() {
            const menuContent = document.getElementById('menuContent');
            menuContent.innerHTML = `
                <div class="error">
                    <h3>‚ö†Ô∏è Êâæ‰∏çÂà∞Á¨¶ÂêàÊ¢ù‰ª∂ÁöÑËèúÂñÆ</h3>
                    <div class="error-details">
                        ÂèØËÉΩÂéüÂõ†Ôºö<br/>
                        ‚Ä¢ È°ûÂà•ÈçµÂêçËàáÈ†êË®≠‰∏çÁ¨¶ÔºàÂ∑≤ÂòóË©¶ÂãïÊÖãÈçµÂêç‰ªçÁÑ°Ë≥áÊñôÔºâ<br/>
                        ‚Ä¢ ÁõÆÂâçÁöÑÊêúÂ∞ãÊàñ„ÄåÈö±ËóèÂîÆÁΩÑ„ÄçÈÅéÊøæÊääÂìÅÈ†ÖÈÉΩÊéíÈô§‰∫Ü
                    </div>
                </div>`;
        }

        function renderMenu(data) {
            const state = store.getState();
            const categories = getEffectiveCategories(data, CATEGORIES);

            const sections = categories
                .map(name => {
                    const items = data[name];
                    if (!Array.isArray(items) || items.length === 0) return null;

                    const filtered = filterItems(items, state.ui);
                    if (filtered.length === 0) return null;

                    return createSection(name, filtered);
                })
                .filter(Boolean);

            if (sections.length === 0) {
                showEmptyState();
                return;
            }

            const { left, right } = distributeColumns(sections, CATEGORIES);
            renderColumns(left, right);
        }

        function renderNotices(meta) {
            const state = store.getState();
            const rulesEl = document.getElementById('rulesList');
            const notesEl = document.getElementById('notesList');

            if (!rulesEl || !notesEl) return;

            const rules = Array.isArray(meta?.rules) ? meta.rules : [];
            const notes = Array.isArray(meta?.notes) ? meta.notes : [];

            rulesEl.innerHTML = rules.map(it => `<li>${escapeHtml(pickText(it, state.ui.currentLang))}</li>`).join('');
            notesEl.innerHTML = notes.map(it => `<li>${escapeHtml(pickText(it, state.ui.currentLang))}</li>`).join('');
        }

        // ===== DATA LOADING =====
        function coerceDataGrouped(raw, menuType) {
            if (!raw) return {};

            // Â¶ÇÊûúÊòØÈô£ÂàóÊ†ºÂºèÔºà‰æÜËá™ÂæåÁ´ØÁöÑ food Êàñ drinkÔºâ
            if (Array.isArray(raw)) {
                const out = {};

                // È£≤ÊñôËèúÂñÆÔºö‰ΩøÁî® categories Èô£ÂàóÂàÜÁµÑ
                if (menuType === 'drink') {
                    for (const it of raw) {
                        // Ê®ôÊ∫ñÂåñÈ£≤ÊñôÈ†ÖÁõÆÊ†ºÂºè
                        const normalized = normalizeDrinkItem(it);

                        // categories ÊòØÈô£ÂàóÔºå‰∏ÄÂÄãÈ£≤ÊñôÂèØËÉΩÂ±¨ÊñºÂ§öÂÄãÂàÜÈ°û
                        const cats = Array.isArray(normalized.categories)
                            ? normalized.categories
                            : [normalized.categories || 'Other'];

                        cats.forEach(cat => {
                            const catName = String(cat).trim();
                            if (catName) {
                                (out[catName] ||= []).push(normalized);
                            }
                        });
                    }
                    return out;
                }

                // È£üÁâ©ËèúÂñÆÔºöÊ†πÊìöÂæåÁ´ØË≥áÊñôÁµêÊßãÔºåÂèØËÉΩÈúÄË¶ÅÊâãÂãïÂàÜÈ°ûÊàñÂÖ®ÈÉ®ÊîæÂú®‰∏ÄÂÄãÂàÜÈ°û
                // Â¶ÇÊûúÂæåÁ´ØÂ∑≤Á∂ìÊåâ sheet ÂêçÁ®±ÂàÜÁµÑÔºåÁõ¥Êé•‰ΩøÁî®
                // Âê¶ÂâáÔºåÂ∞áÊâÄÊúâÈ†ÖÁõÆÊîæÂú® 'ALL' ÂàÜÈ°û‰∏≠
                for (const it of raw) {
                    const cat = (it && (it.category || it.Category || it.categoryName))
                        ? String(it.category || it.Category || it.categoryName)
                        : 'FOOD';  // È†êË®≠ÂàÜÈ°ûÂêçÁ®±

                    if (cat) {
                        (out[cat] ||= []).push(stripCategory(it));
                    }
                }
                return out;
            }

            // Â¶ÇÊûúÂ∑≤Á∂ìÊòØÂàÜÁµÑÊ†ºÂºè
            if (typeof raw === 'object' && !Array.isArray(raw)) {
                const out = {};
                for (const k of Object.keys(raw)) {
                    if (k === '_meta') continue;
                    const v = raw[k];
                    if (Array.isArray(v)) {
                        // Â¶ÇÊûúÊòØÈ£≤ÊñôËèúÂñÆÔºåÊ®ôÊ∫ñÂåñÊØèÂÄãÈ†ÖÁõÆ
                        out[k] = menuType === 'drink'
                            ? v.map(normalizeDrinkItem)
                            : v;
                    }
                }
                if (Object.keys(out).length) return out;
            }

            return {};
        }

        // Ê®ôÊ∫ñÂåñÈ£≤ÊñôÈ†ÖÁõÆÔºàÂ∞áÂæåÁ´ØÊ†ºÂºèËΩâÊèõÁÇ∫ÂâçÁ´ØÊ†ºÂºèÔºâ
        function normalizeDrinkItem(item) {
            return {
                // ‰∏ªË¶ÅÊ¨Ñ‰ΩçÔºàÂæåÁ´ØÂ∑≤Á∂ìÊâÅÂπ≥ÂåñÔºåÁõ¥Êé•‰ΩøÁî®Ôºâ
                'zh-TW': item.zh || '',  // ‰øÆÊ≠£Ôºö‰ΩøÁî® item.zh
                en: item.en || '',       // ‰øÆÊ≠£Ôºö‰ΩøÁî® item.enÔºà‰∏çÊòØ item.lang.enÔºâ
                ja: item.ja || '',
                ko: item.ko || '',
                fr: item.fr || '',
                th: item.th || '',
                fil: item.fil || '',
                vi: item.vi || '',

                // ÂÉπÊ†ºËàáÁãÄÊÖã
                price: item.price,
                'soldout': item.soldout,

                // È£≤ÊñôÂ∞àÁî®Â±¨ÊÄß
                alcohol: item.alcohol,
                body: item.body,
                flavor: item.flavor,
                categories: item.categories,

                // Êñ∞Â¢ûÊ¨Ñ‰Ωç
                ingredients: item.ingredients || '',
                notes: item.notes || '',

                // ÂúñÁâá
                'img': item.img || '',

                // ‰øùÁïôÂéüÂßã‰æÜÊ∫ê
                source: item.source
            };
        }

        function stripCategory(it) {
            const clone = { ...it };
            delete clone.categories;
            delete clone.category;
            delete clone.Category;
            delete clone.categoryName;
            return clone;
        }

        async function loadMenuData(menuType, silent = false) {
            const menuContent = document.getElementById('menuContent');
            if (!silent) {
                menuContent.innerHTML = '<div class="loading">Ê≠£Âú®ËºâÂÖ•ËèúÂñÆ</div>';
            }

            const apiUrl = API_URLS[menuType];
            if (!apiUrl) {
                console.error(`Unknown menu type: ${menuType}`);
                return;
            }

            try {
                const res = await fetch(apiUrl, { cache: 'no-store' });
                if (!res.ok) throw new Error(`HTTP ${res.status}: ${res.statusText}`);

                const raw = await res.json();

                // Ê™¢Êü•ÊòØÂê¶ÊúâÈåØË™§
                if (raw.error) {
                    throw new Error(raw.message || 'API ÂõûÂÇ≥ÈåØË™§');
                }

                // ÊèêÂèñ _meta
                const metaData = (raw && typeof raw === 'object' && raw._meta)
                    ? raw._meta
                    : { rules: [], notes: [] };

                // Ê†πÊìöËèúÂñÆÈ°ûÂûãÊèêÂèñÂ∞çÊáâÁöÑË≥áÊñôÈô£Âàó
                // ÂæåÁ´ØÊ†ºÂºèÔºö{ food: [...], drink: [...], _meta: {...} }
                const rawMenuArray = raw[menuType];

                if (!Array.isArray(rawMenuArray)) {
                    console.warn(`${menuType} Ë≥áÊñô‰∏çÊòØÈô£ÂàóÊ†ºÂºè:`, rawMenuArray);
                    throw new Error(`ÂæåÁ´ØÂõûÂÇ≥ÁöÑ ${menuType} Ë≥áÊñôÊ†ºÂºè‰∏çÊ≠£Á¢∫`);
                }

                // Â∞áÈô£ÂàóËΩâÊèõÁÇ∫ÂàÜÈ°ûÂàÜÁµÑÊ†ºÂºè
                const menuData = coerceDataGrouped(rawMenuArray, menuType);

                console.log(`${menuType} ËºâÂÖ•ÂÆåÊàê:`, {
                    ÂéüÂßãÈ†ÖÁõÆÊï∏: rawMenuArray.length,
                    ÂàÜÈ°ûÊï∏: Object.keys(menuData).length,
                    ÂàÜÈ°ûÂàóË°®: Object.keys(menuData)
                });

                // Ê†πÊìöËèúÂñÆÈ°ûÂûãÊõ¥Êñ∞Â∞çÊáâÁöÑÁãÄÊÖã
                if (menuType === 'food') {
                    store.setState({
                        foodData: menuData,
                        foodMeta: metaData
                    });
                } else if (menuType === 'drink') {
                    store.setState({
                        drinkData: menuData,
                        drinkMeta: metaData
                    });
                }
            } catch (err) {
                console.error(`ËºâÂÖ• ${menuType} ËèúÂñÆÂ§±Êïó:`, err);
                menuContent.innerHTML = `
                    <div class="error">
                        <h3>‚ùå ËºâÂÖ•${menuType === 'food' ? 'È£üÁâ©' : 'È£≤Êñô'}ËèúÂñÆÂ§±Êïó</h3>
                        <p><strong>${escapeHtml(err.message)}</strong></p>
                        <div class="error-details">
                            Ë´ãÁ¢∫Ë™çÔºöAPI URL Ê≠£Á¢∫„ÄÅÂ∑≤ÈÉ®ÁΩ≤ÔºåÊàñÁõ¥Êé•ÈñãÂïüÔºö
                            <div style="margin-top:6px">
                                <a href="${apiUrl}" target="_blank" style="color:#ffd700;text-decoration:underline">Ê∏¨Ë©¶ API URL</a>
                            </div>
                            <div style="margin-top:8px;font-size:0.9em;opacity:0.8">
                                ÈåØË™§Ë©≥ÊÉÖ: ${escapeHtml(err.stack || err.toString())}
                            </div>
                        </div>
                    </div>`;
            }
        }

        // ËºâÂÖ•ÊâÄÊúâËèúÂñÆÔºàÂæûÂêå‰∏ÄÂÄã APIÔºå‰ΩÜ‰ΩøÁî®‰∏çÂêåÁöÑ keyÔºâ
        async function loadAllMenus() {
            // Ê≥®ÊÑèÔºöÂ¶ÇÊûúÂÖ©ÂÄã API URL Áõ∏ÂêåÔºåÂè™ÈúÄÂëºÂè´‰∏ÄÊ¨°
            if (API_URLS.food === API_URLS.drink) {
                // Âêå‰∏ÄÂÄã API ÂõûÂÇ≥ { food: [...], drink: [...] }
                const menuContent = document.getElementById('menuContent');
                menuContent.innerHTML = '<div class="loading">Ê≠£Âú®ËºâÂÖ•ËèúÂñÆ</div>';

                try {
                    const res = await fetch(API_URLS.food, { cache: 'no-store' });
                    if (!res.ok) throw new Error(`HTTP ${res.status}: ${res.statusText}`);

                    const raw = await res.json();

                    if (raw.error) {
                        throw new Error(raw.message || 'API ÂõûÂÇ≥ÈåØË™§');
                    }

                    const metaData = raw._meta || { rules: [], notes: [] };

                    // ÂàÜÂà•ËôïÁêÜ food Âíå drink
                    const foodData = coerceDataGrouped(raw.food || [], 'food');
                    const drinkData = coerceDataGrouped(raw.drink || [], 'drink');

                    console.log('Áµ±‰∏Ä API ËºâÂÖ•ÂÆåÊàê:', {
                        food: { È†ÖÁõÆÊï∏: raw.food?.length, ÂàÜÈ°ûÊï∏: Object.keys(foodData).length },
                        drink: { È†ÖÁõÆÊï∏: raw.drink?.length, ÂàÜÈ°ûÊï∏: Object.keys(drinkData).length }
                    });

                    store.setState({
                        foodData,
                        drinkData,
                        foodMeta: metaData,
                        drinkMeta: metaData
                    });
                } catch (err) {
                    console.error('ËºâÂÖ•ËèúÂñÆÂ§±Êïó:', err);
                    menuContent.innerHTML = `
                        <div class="error">
                            <h3>‚ùå ËºâÂÖ•ËèúÂñÆÂ§±Êïó</h3>
                            <p><strong>${escapeHtml(err.message)}</strong></p>
                            <div class="error-details">
                                Ë´ãÁ¢∫Ë™ç API Â∑≤Ê≠£Á¢∫ÈÉ®ÁΩ≤
                            </div>
                        </div>`;
                }
            } else {
                // ÂÖ©ÂÄã‰∏çÂêåÁöÑ API
                await Promise.all([
                    loadMenuData('food', false),
                    loadMenuData('drink', true)
                ]);
            }
        }

        // ===== EVENT HANDLERS (EVENT DELEGATION) =====
        function switchMenuType(menuType) {
            const state = store.getState();
            store.setState({ ui: { ...state.ui, currentMenuType: menuType } });

            // Êõ¥Êñ∞ÂàÜÈ†ÅÊåâÈàïÁãÄÊÖã
            document.querySelectorAll('.menu-tab').forEach(btn => {
                const type = btn.getAttribute('data-menu-type');
                btn.setAttribute('aria-selected', String(type === menuType));
            });

            // Â¶ÇÊûúË©≤ËèúÂñÆË≥áÊñôÂ∞öÊú™ËºâÂÖ•ÔºåÂâáËºâÂÖ•
            const dataKey = menuType === 'food' ? 'foodData' : 'drinkData';
            if (Object.keys(state[dataKey]).length === 0) {
                loadMenuData(menuType, false);
            }
        }

        function switchLanguage(lang) {
            const state = store.getState();
            store.setState({ ui: { ...state.ui, currentLang: lang } });

            // Êõ¥Êñ∞Ë™ûË®ÄÊåâÈàïÁãÄÊÖã
            document.querySelectorAll('.lang-btn').forEach(btn => {
                const code = btn.getAttribute('data-code');
                btn.setAttribute('aria-pressed', String(code === lang));
                btn.setAttribute('tabindex', code === lang ? '0' : '-1');
            });

            // ÂêåÊ≠•Êõ¥Êñ∞‰∏ãÊãâÈÅ∏ÂñÆ (ÊâãÊ©üÁâà)
            const select = document.getElementById('languageSelect');
            if (select) {
                select.value = lang;
            }
        }

        function handleTabKeydown(e) {
            const tabs = Array.from(document.querySelectorAll('.lang-btn'));
            const currentIndex = tabs.indexOf(e.target);

            let nextIndex = currentIndex;
            if (e.key === 'ArrowRight' || e.key === 'ArrowDown') {
                nextIndex = (currentIndex + 1) % tabs.length;
            }
            if (e.key === 'ArrowLeft' || e.key === 'ArrowUp') {
                nextIndex = (currentIndex - 1 + tabs.length) % tabs.length;
            }

            if (nextIndex !== currentIndex) {
                e.preventDefault();
                tabs.forEach(t => t.setAttribute('tabindex', '-1'));
                tabs[nextIndex].setAttribute('tabindex', '0');
                tabs[nextIndex].focus();
                tabs[nextIndex].click();
            }
        }

        // ===== INITIALIZATION =====
        function setupLanguageSwitcher() {
            const container = document.querySelector('.language-switcher');
            const select = document.getElementById('languageSelect');
            const state = store.getState();

            // Ë®≠ÂÆöÊåâÈàï (Ê°åÈù¢Áâà)
            LANGUAGES.forEach((lang, idx) => {
                const btn = document.createElement('button');
                btn.className = 'lang-btn';
                btn.textContent = lang.label;
                btn.setAttribute('role', 'tab');
                btn.setAttribute('data-code', lang.code);
                btn.setAttribute('tabindex', idx === 0 ? '0' : '-1');
                btn.setAttribute('aria-pressed', String(lang.code === state.ui.currentLang));

                container.appendChild(btn);
            });

            // Ë®≠ÂÆö‰∏ãÊãâÈÅ∏ÂñÆÈ†êÈÅ∏ÂÄº (ÊâãÊ©üÁâà)
            if (select) {
                select.value = state.ui.currentLang;

                // ‰∏ãÊãâÈÅ∏ÂñÆËÆäÊõ¥‰∫ã‰ª∂
                select.addEventListener('change', (e) => {
                    const code = e.target.value;
                    store.setState({ ui: { currentLang: code } });

                    // ÂêåÊ≠•Êõ¥Êñ∞ÊåâÈàïÁãÄÊÖã
                    document.querySelectorAll('.lang-btn').forEach(btn => {
                        const isActive = btn.getAttribute('data-code') === code;
                        btn.setAttribute('aria-pressed', String(isActive));
                    });
                });
            }
        }

        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        function init() {
            setupLanguageSwitcher();

            // ‰∫ã‰ª∂ÂßîÊ¥æÔºöÂàÜÈ†ÅÂàáÊèõ
            document.addEventListener('click', (e) => {
                const tab = e.target.closest('.menu-tab');
                if (!tab) return;

                const menuType = tab.getAttribute('data-menu-type');
                if (menuType) switchMenuType(menuType);
            });

            // ‰∫ã‰ª∂ÂßîÊ¥æÔºöË™ûË®ÄÂàáÊèõ
            document.addEventListener('click', (e) => {
                const btn = e.target.closest('.lang-btn');
                if (!btn) return;

                const lang = btn.getAttribute('data-code');
                if (lang) switchLanguage(lang);
            });

            // ‰∫ã‰ª∂ÂßîÊ¥æÔºöË™ûË®ÄÂàáÊèõÈçµÁõ§ÊîØÊè¥
            document.addEventListener('keydown', (e) => {
                const btn = e.target.closest('.lang-btn');
                if (!btn) return;
                handleTabKeydown(e);
            });

            // ‰∫ã‰ª∂ÂßîÊ¥æÔºöÁØ©ÈÅ∏ÊåâÈàï
            document.addEventListener('click', (e) => {
                const btn = e.target.closest('.filter-btn');
                if (!btn) return;

                const filter = btn.getAttribute('data-filter') || 'all';
                const state = store.getState();
                store.setState({ ui: { ...state.ui, currentFilter: filter } });

                // Êõ¥Êñ∞ aria-pressed
                document.querySelectorAll('.filter-btn').forEach(b =>
                    b.setAttribute('aria-pressed', String(b === btn))
                );
            });

            // ÊêúÂ∞ãËº∏ÂÖ•ÔºàÂä†ÂÖ•Èò≤ÊäñÔºâ
            const searchInput = document.getElementById('q');
            const debouncedSearch = debounce((value) => {
                const state = store.getState();
                store.setState({ ui: { ...state.ui, query: value.toLowerCase().trim() } });
            }, SEARCH_DEBOUNCE_MS);

            searchInput.addEventListener('input', (e) => {
                debouncedSearch(e.target.value);
            });

            // Èö±ËóèÂîÆÁΩÑ
            const soldoutCheckbox = document.getElementById('hideSoldout');
            soldoutCheckbox.addEventListener('change', (e) => {
                const state = store.getState();
                store.setState({ ui: { ...state.ui, hideSoldOut: e.target.checked } });
            });

            // Âà∑Êñ∞ÊåâÈàï
            const refreshBtn = document.getElementById('refreshBtn');
            refreshBtn.addEventListener('click', () => {
                refreshBtn.disabled = true;
                const icon = document.getElementById('refreshIcon');
                icon.classList.add('spin');

                const state = store.getState();
                loadMenuData(state.ui.currentMenuType, true).finally(() => {
                    refreshBtn.disabled = false;
                    icon.classList.remove('spin');
                });
            });

            // Popover ÊéßÂà∂ÂáΩÊï∏
            function openPopover(itemData, itemName, clickedElement) {
                const state = store.getState();
                const lang = state.ui.currentLang;

                const popover = document.getElementById('infoPopover');
                const popoverTitle = document.getElementById('popoverTitle');
                const popoverBody = document.getElementById('popoverBody');

                // Ë®≠ÂÆöÊ®ôÈ°å
                popoverTitle.textContent = itemName;

                // Âª∫Á´ãÂÖßÂÆπ
                const sections = [];

                const allergensText = pickLangText(itemData.contains, lang);
                const ingredientsText = pickLangText(itemData.ingredients, lang);
                const notesText = pickLangText(itemData.notes, lang);

                if (allergensText) {
                    sections.push({
                        key: 'allergens',
                        content: allergensText
                    });
                }

                if (ingredientsText) {
                    sections.push({
                        key: 'ingredients',
                        content: ingredientsText
                    });
                }

                if (notesText) {
                    sections.push({
                        key: 'notes',
                        content: notesText
                    });
                }

                if (sections.length === 0) {
                    const noInfoMsg = NO_INFO_MESSAGES[lang] || NO_INFO_MESSAGES.en;
                    popoverBody.innerHTML = `
                        <div style="text-align: center; padding: 20px; color: var(--text-secondary);">
                            <p style="font-size: 0.95em;">${escapeHtml(noInfoMsg)}</p>
                        </div>
                    `;
                } else {
                    popoverBody.innerHTML = sections.map(sec => `
                        <div class="popover-section">
                            <div class="popover-section-title">
                                <span>${ACCORDION_LABELS[sec.key]?.[lang] || ACCORDION_LABELS[sec.key]?.en}</span>
                            </div>
                            <div class="popover-section-content">
                                ${escapeHtml(sec.content)}
                            </div>
                        </div>
                    `).join('');
                }

                // Ë®àÁÆó Popover ‰ΩçÁΩÆÔºàÁõ∏Â∞çÊñºÈªûÊìäÁöÑÂÖÉÁ¥†Ôºâ
                const rect = clickedElement.getBoundingClientRect();
                const popoverWidth = 350; // È†ê‰º∞ÂØ¨Â∫¶
                const popoverHeight = 200; // È†ê‰º∞È´òÂ∫¶
                const spacing = 12;

                // È†êË®≠È°ØÁ§∫Âú®Âè≥ÂÅ¥
                let left = rect.right + spacing;
                let top = rect.top;

                // Â¶ÇÊûúÂè≥ÂÅ¥Á©∫Èñì‰∏çË∂≥ÔºåÈ°ØÁ§∫Âú®Â∑¶ÂÅ¥
                if (left + popoverWidth > window.innerWidth) {
                    left = rect.left - popoverWidth - spacing;
                }

                // Â¶ÇÊûúÂ∑¶ÂÅ¥‰πü‰∏çË∂≥ÔºåÊîπÁÇ∫È°ØÁ§∫Âú®‰∏ãÊñπ
                if (left < 0) {
                    left = rect.left;
                    top = rect.bottom + spacing;
                }

                // Á¢∫‰øù‰∏çË∂ÖÂá∫Ë¶ñÁ™ó
                left = Math.max(10, Math.min(left, window.innerWidth - popoverWidth - 10));
                top = Math.max(10, Math.min(top, window.innerHeight - popoverHeight - 10));

                popover.style.left = `${left}px`;
                popover.style.top = `${top}px`;

                // È°ØÁ§∫ Popover
                popover.classList.add('active');
            }

            function closePopover() {
                const popover = document.getElementById('infoPopover');
                popover.classList.remove('active');
            }

            // ‰∫ã‰ª∂ÂßîÊ¥æÔºöÈªûÊìäÂìÅÂêçÈ°ØÁ§∫ Popover
            document.addEventListener('click', (e) => {
                const namePrimary = e.target.closest('.name-primary');

                if (namePrimary) {
                    // ÊâæÂà∞Â∞çÊáâÁöÑËèúÂñÆÈ†ÖÁõÆ
                    const menuItem = namePrimary.closest('.menu-item');
                    if (!menuItem) return;

                    // Âæû DOM ‰∏≠ÂèñÂæóÂìÅÂêç
                    const itemName = namePrimary.textContent.replace(/\s*\(.*?\)\s*/g, '').trim();

                    // ÂæûÁï∂ÂâçË≥áÊñô‰∏≠ÊâæÂà∞Â∞çÊáâÁöÑÈ†ÖÁõÆ
                    const state = store.getState();
                    const currentData = state.ui.currentMenuType === 'food' ? state.foodData : state.drinkData;

                    // ÊêúÂ∞ãÊâÄÊúâÂàÜÈ°û‰∏≠ÁöÑÈ†ÖÁõÆ
                    let itemData = null;
                    for (const category in currentData) {
                        const items = currentData[category];
                        if (Array.isArray(items)) {
                            itemData = items.find(item => {
                                const names = [item.zh, item['zh-TW'], item.en, item.ja, item.ko, item.fr, item.th, item.fil, item.vi]
                                    .filter(Boolean)
                                    .map(n => n.trim());
                                return names.some(n => n === itemName || itemName.includes(n));
                            });
                            if (itemData) break;
                        }
                    }

                    if (itemData) {
                        openPopover(itemData, itemName, namePrimary);
                    }
                } else {
                    // ÈªûÊìäÂÖ∂‰ªñÂú∞ÊñπÈóúÈñâ Popover
                    const popover = document.getElementById('infoPopover');
                    const popoverClose = document.getElementById('popoverClose');

                    if (popover && !popover.contains(e.target) && e.target !== popoverClose) {
                        closePopover();
                    }
                }
            });

            // Popover ÈóúÈñâÊåâÈàï
            document.getElementById('popoverClose').addEventListener('click', (e) => {
                e.stopPropagation();
                closePopover();
            });

            // ESC ÈçµÈóúÈñâ
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') {
                    closePopover();
                }
            });

            // ËºâÂÖ•ÂàùÂßãË≥áÊñôÔºàÂêåÊôÇËºâÂÖ•ÂÖ©ÂÄãËèúÂñÆÔºâ
            loadAllMenus();
        }

        // ===== START =====
        init();
    </script>
</body>
</html>
